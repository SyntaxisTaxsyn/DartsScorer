<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Darts Scorer</title>
  <link rel="canonical" href="https://syntaxistaxsyn.github.io/DartsScorer/" />
  <link rel="manifest" href="/DartsScorer/manifest.webmanifest">
  <link rel="stylesheet" href="css/styles.css">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      overflow-x: hidden;
    }

    #rotate-warning {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background: #000000cc;
      color: white;
      font-size: 24px;
      z-index: 10;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 20px;
    }
    
    .button-grid {
  display: grid;
  grid-template-columns: repeat(20, 1fr);
  gap: 1px;
  padding: 1px;
}

.button-grid button {
  font-size: 1.1em;
  padding: 8px 0;
  border: 1px solid #ccc;
  border-radius: 0;
  background-color: #f0f0f0;
  touch-action: manipulation;
}

    .button-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      padding: 10px;
    }
    
    .button-row button {
  flex: 1 1 32%;
  margin: 1px;
  padding: 12px 0;
  font-size: 1.2em;
  border-radius: 0;
  background-color: #f0f0f0;
  border: 1px solid #ccc;
  touch-action: manipulation;
}

.button-row button.active {
  background-color: #4CAF50;
  color: white;
}

    button {
      flex: 1 1 auto;
      margin: 5px;
      font-size: 1.5em;
      padding: 20px 0;
      min-width: 5%;
    }

    #score-display {
      text-align: center;
      font-size: 2em;
      padding: 10px;
    }

    #reset-button,
#complete-button {
  font-size: 1.5em;
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  color: white;
  display: inline-block;
  cursor: pointer;
}

#reset-button {
  background: red;
}

#complete-button {
  background: green;
}
    
    #dart-history-container {
  position: absolute;
  bottom: 10px;
  left: 10px;
  max-width: 300px;
  background-color: #fff;
  border: 1px solid #ccc;
  font-size: 0.9em;
  overflow: auto;
}

#dart-history {
  width: 100%;
  border-collapse: collapse;
}

#dart-history th, #dart-history td {
  border: 1px solid #ccc;
  padding: 4px 6px;
  text-align: center;
}

#dart-history button {
  font-size: 0.8em;
  padding: 2px 4px;
}

.center-score-row {
  display: flex;
  justify-content: space-around;
  padding: 5px 10px;
}

.center-score-row button {
  flex: 1 1 48%;
  font-size: 1.1em;
  padding: 10px 0;
  margin: 1px;
  border-radius: 0;
  border: 1px solid #ccc;
  background-color: #f0f0f0;
  touch-action: manipulation;
}

  </style>
</head>
<body>

<div id="rotate-warning">Please rotate your device to landscape mode to use this app.</div>

<div id="app">
  <div id="score-display">Score: 0 | Darts: 0/3</div>

  <!-- Score Buttons 1-20 -->
  <div class="button-grid" id="score-buttons">
    <!-- Generated by JS -->
  </div>
  
  <div class="center-score-row">
  <button onclick="registerScore(25)">25</button>
  <button onclick="registerScore(50)">50</button>
</div>

  <!-- Double and Treble Buttons -->
  <div class="button-row">
  <button id="double-btn" onclick="toggleMultiplier(2)">Double</button>
  <button id="treble-btn" onclick="toggleMultiplier(3)">Treble</button>
  <button id="miss-btn" onclick="registerScore(0)">Miss</button>
</div>

<div style="display: flex; justify-content: center; gap: 10px; margin-top: 10px;">
  <button id="reset-button" onclick="resetGame()">Reset</button>
  <button id="complete-button" onclick="completeThrow()">Complete Throw</button>
</div>

<div id="dart-history-container">
  <table id="dart-history">
    <thead>
      <tr>
        <th>#</th>
        <th>Score</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <!-- Dart rows will go here -->
    </tbody>
  </table>
</div>
<div id="player-score-table" style="position: absolute; bottom: 10px; right: 10px; max-width: 200px;">
  <table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">
    <thead>
      <tr>
        <th>Player</th>
        <th>Score</th>
      </tr>
    </thead>
    <tbody id="player-score-body">
      <!-- Filled by JS -->
    </tbody>
  </table>
</div>
</div>

<script>
  const scoreButtonsContainer = document.getElementById('score-buttons');
  const scoreDisplay = document.getElementById('score-display');
  const rotateWarning = document.getElementById('rotate-warning');

  let score = 0;
  let darts = 0;
  let multiplier = 1;
  let gameOver = false;
  let dartLog = []; // Stores dart objects
  
  let players = [
  { name: 'Player 1', score: 501 },
  { name: 'Player 2', score: 501 }
];
let currentPlayer = 0;

  // Generate score buttons 1-20
  for (let i = 1; i <= 20; i++) {
    const btn = document.createElement('button');
    btn.textContent = i;
    btn.onclick = () => registerScore(i);
    scoreButtonsContainer.appendChild(btn);
  }

  function registerScore(val) {
  //if (gameOver) return;
  if (gameOver || darts >= 3) return;

  // Restrict double/treble on 25 and 50
  let appliedMultiplier = multiplier;
  if ((val === 25 || val === 50) && multiplier > 1) {
    appliedMultiplier = 1;
  }

  const appliedScore = val * appliedMultiplier;
  const label = val === 0 ? "Miss" :
                (val === 25 || val === 50) ? `${val}` :
                appliedMultiplier === 2 ? `Double ${val}` :
                appliedMultiplier === 3 ? `Treble ${val}` :
                `${val}`;

  // Add to log
  dartLog.push({ value: val, score: appliedScore, label });

  score += appliedScore;
  darts += 1;

  // Reset multiplier
  multiplier = 1;
  document.getElementById('double-btn').classList.remove('active');
  document.getElementById('treble-btn').classList.remove('active');

  updateDisplay();
  updateDartHistory();

  if (darts >= 3) {
    gameOver = true;
  }
}

  function toggleMultiplier(val) {
  if (gameOver) return;

  // Get button elements
  const doubleBtn = document.getElementById('double-btn');
  const trebleBtn = document.getElementById('treble-btn');

  // Toggle logic
  if (multiplier === val) {
    // Same button tapped again — deactivate
    multiplier = 1;
    doubleBtn.classList.remove('active');
    trebleBtn.classList.remove('active');
  } else {
    // Activate this multiplier, deactivate the other
    multiplier = val;
    if (val === 2) {
      doubleBtn.classList.add('active');
      trebleBtn.classList.remove('active');
    } else {
      trebleBtn.classList.add('active');
      doubleBtn.classList.remove('active');
    }
  }
}

  //function updateDisplay() {
   // scoreDisplay.textContent = `Score: ${score} | Darts: ${darts}/3`;
  //}
  
  function updateDisplay() {
  const playerText = `${players[0].name}: ${players[0].score} | ${players[1].name}: ${players[1].score}`;
  const turnText = `Current: ${players[currentPlayer].name}`;
  //scoreDisplay.textContent = `${playerText} | ${turnText} | Round Score: ${score} | Darts: ${darts}/3`;
  scoreDisplay.textContent = `Score: ${score} | Darts: ${darts}/3`;
}

  function resetGame() {
  score = 0;
  darts = 0;
  multiplier = 1;
  gameOver = false;
  currentPlayer = 0;
  players = [
    { name: 'Player 1', score: 501 },
    { name: 'Player 2', score: 501 }
  ];
  document.getElementById('double-btn').classList.remove('active');
  document.getElementById('treble-btn').classList.remove('active');
  dartLog = [];
  updateDartHistory();
  updateDisplay();
  updatePlayerTable();
}

  function checkOrientation() {
  const isLandscape =
    (window.screen.orientation && window.screen.orientation.type.startsWith('landscape')) ||
    window.innerWidth > window.innerHeight;

  if (isLandscape) {
    rotateWarning.style.display = 'none';
    document.getElementById('app').style.display = 'block';
  } else {
    rotateWarning.style.display = 'flex';
    document.getElementById('app').style.display = 'none';
  }
}
  
  function updateDartHistory() {
  const tbody = document.querySelector("#dart-history tbody");
  tbody.innerHTML = ''; // Clear previous

  dartLog.forEach((dart, index) => {
    const row = document.createElement('tr');

    const dartNum = document.createElement('td');
    dartNum.textContent = index + 1;

    const dartLabel = document.createElement('td');
    dartLabel.textContent = dart.label;

    const undoCell = document.createElement('td');
    const undoBtn = document.createElement('button');
    undoBtn.textContent = "Undo";
    undoBtn.onclick = () => undoDart(index);
    undoCell.appendChild(undoBtn);

    row.appendChild(dartNum);
    row.appendChild(dartLabel);
    row.appendChild(undoCell);

    tbody.appendChild(row);
  });
}

function undoDart(index) {
  if (index >= 0 && index < dartLog.length) {
    const dart = dartLog.splice(index, 1)[0];
    score -= dart.score;
    darts -= 1;
    gameOver = false;
    updateDisplay();
    updateDartHistory();
  }
}

function completeThrow() {
  if (darts === 0) return; // No darts thrown

  players[currentPlayer].score -= score;
  if (players[currentPlayer].score <= 0) {
    alert(`${players[currentPlayer].name} wins!`);
    gameOver = true;
  }
  
  if(currentPlayer === 0){
    currentPlayer = 1;
  } else {
    currentPlayer = 0;
  }
  // Switch player
  //currentPlayer = (currentPlayer + 1) % 2;

  // Reset throw
  score = 0;
  darts = 0;
  multiplier = 1;
  gameOver = 0;
  document.getElementById('double-btn').classList.remove('active');
  document.getElementById('treble-btn').classList.remove('active');
  dartLog = [];
  updateDartHistory();
  updateDisplay();
  updatePlayerTable();
}

function updatePlayerTable() {
  const tbody = document.getElementById('player-score-body');
  tbody.innerHTML = '';
  players.forEach((player, index) => {
    const row = document.createElement('tr');
    const nameCell = document.createElement('td');
    nameCell.textContent = player.name + (index === currentPlayer ? ' ←' : '');
    const scoreCell = document.createElement('td');
    scoreCell.textContent = player.score;
    row.appendChild(nameCell);
    row.appendChild(scoreCell);
    tbody.appendChild(row);
  });
}
  let checkTimeout = 1000;
  window.addEventListener('resize', () => setTimeout(checkOrientation, checkTimeout));
  window.addEventListener('orientationchange', () => setTimeout(checkOrientation, checkTimeout));
window.addEventListener('load', () => {
  checkOrientation();
  updatePlayerTable();
  updateDisplay();
});
</script>

</body>
</html>
